<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>funcwc - SSR-First Component Library Demo</title>
    
    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="/favicon.svg">
    <link rel="icon" type="image/x-icon" href="/favicon.ico">

    <!-- Base CSS: Open Props (variables) + Normalize (efficient, from CDN) -->
    <link rel="preconnect" href="https://unpkg.com">
    <link rel="preconnect" href="https://cdn.jsdelivr.net">
    <link
      rel="stylesheet"
      href="/assets/open-props/1.7.16/normalize.min.css"
    >
    <link
      rel="stylesheet"
      href="/assets/open-props/1.7.16/open-props.min.css"
    >
    <!-- Open Props UI modules (buttons, forms, typography) -->
    <link
      rel="stylesheet"
      href="/assets/open-props/1.7.16/buttons.min.css"
    >
    <link
      rel="stylesheet"
      href="/assets/open-props/1.7.16/fonts.min.css"
    >

    <!-- HTMX for reactivity -->
    <script src="https://unpkg.com/htmx.org@2.0.6"></script>
    <!-- HTMX v2 extension packages are separate: use htmx-ext-json-enc -->
    <script
      src="https://unpkg.com/htmx-ext-json-enc@2.0.1/json-enc.js"
    ></script>

    <!-- CSS theme variables for reactivity -->
    <style>
      :root {
        --theme-mode: light;
        --theme-bg: white;
        --theme-text: #333;
        --theme-accent: #007bff;
      }

      body {
        margin: 0;
        font-family:
          -apple-system, BlinkMacSystemFont, "Segoe UI", system-ui,
          sans-serif;
        background: var(--theme-bg);
        color: var(--theme-text);
        transition: background-color 0.3s ease, color 0.3s ease;
      }
    </style>
  </head>
  <body hx-ext="json-enc" hx-encoding="json">
    <script>
      // Minimal fallback: ensure window.funcwcState exists so badges can subscribe
      (function(){
        try {
          if (window.funcwcState) return;
          window.funcwcState = {
            _state: new Map(),
            _subscribers: new Map(),
            publish: function(topic, data){
              this._state.set(topic, { data: data, timestamp: Date.now() });
              var subs = this._subscribers.get(topic) || [];
              var alive = [];
              for (var i = 0; i < subs.length; i++) {
                var s = subs[i];
                if (document.contains(s.element)) {
                  try { s.callback.call(s.element, data); } catch (_) {}
                  alive.push(s);
                }
              }
              this._subscribers.set(topic, alive);
            },
            subscribe: function(topic, callback, element){
              if (typeof topic !== 'string' || typeof callback !== 'function' || !(element instanceof Element)) return;
              var subs = this._subscribers.get(topic) || [];
              subs.push({ callback: callback, element: element });
              this._subscribers.set(topic, subs);
              if (this._state.has(topic)) {
                try { callback.call(element, this._state.get(topic).data); } catch (_) {}
              }
            },
            getState: function(topic){
              var entry = this._state.get(topic); return entry ? entry.data : undefined;
            },
            clearTopic: function(topic){ this._state.delete(topic); this._subscribers.delete(topic); },
            getTopics: function(){ return Array.from(this._state.keys()); },
            getSubscriberCount: function(topic){ var s = this._subscribers.get(topic); return s ? s.length : 0; }
          };
        } catch (_) {}
      })();
    </script>
    <!-- Single component - the entire app -->
    <!-- State manager is now injected by the app-layout component -->
    <app-layout></app-layout>
  </body>
</html>
